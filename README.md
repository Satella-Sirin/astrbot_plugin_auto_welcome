# 自动欢迎插件

**作者**：Satella-Sirin  
**版本**：1.0.0  
**描述**：在指定群聊中自动欢迎新成员，支持白名单群、全局默认欢迎词、各群专属欢迎词，并允许使用自定义符号将一条消息拆分成多条独立发送。

> **⚠️ 平台支持说明**  
> 本插件基于 OneBot 协议（`aiocqhttp`）开发，仅适用于该协议。若在 QQ 官方接口、微信等其他平台上运行，可能无法正常工作。请确保您的 AstrBot 使用的是 OneBot 适配器。

## ✨ 功能特性

- 监听群成员增加事件，自动发送欢迎消息
- 支持**白名单群**配置（只有设定的群才会触发）
- 欢迎消息支持两个占位符：
  - `{nickname}`：替换为新成员的真实昵称（优先群名片，其次 QQ 昵称）
  - `{at}`：替换为真正的 @ 功能（QQ 的 @ 消息段，对方会收到提醒）
- **支持为不同群设置专属欢迎词**：通过多行文本配置，每行指定一个群号和对应的欢迎消息
- **可自定义分段符号**：通过设置分隔符，将一条消息按符号拆分为多条独立消息发送（符号本身不会保留）
- 提供 WebUI 配置界面，无需手动编辑文件
- 配置文件独立存储，保证配置持久化且不受框架更新影响
- 代码结构清晰，配置解析拆分独立方法，并增加空配置警告提示

## 📦 安装方法

### 方法一：通过 AstrBot 插件市场安装（推荐）
1. 打开 AstrBot WebUI，进入“插件管理”
2. 点击“插件市场”，搜索“自动欢迎”
3. 点击“安装”，安装后启用插件即可

### 方法二：手动上传
1. 准备以下三个文件：
   - `main.py`
   - `metadata.yaml`
   - `_conf_schema.json`
2. 将这三个文件放在同一文件夹内，压缩为 ZIP 包
3. 在 AstrBot WebUI 的“插件管理”中，点击“上传插件”，选择 ZIP 包上传
4. 上传后启用插件

## ⚙️ 配置说明

插件安装并启用后，您可以通过两种方式配置：

### 1. WebUI 配置（推荐）
- 在“插件管理”页面找到“自动欢迎”插件，点击右侧的“配置”按钮
- 在弹出的配置界面中设置：

| 配置项 | 说明 |
|--------|------|
| **启用自动欢迎的群号列表** | 每行输入一个 QQ 群号（纯数字），只有这些群会触发欢迎 |
| **全局默认欢迎消息模板** | 当某个群没有设置专属消息时，使用此模板。支持 `{nickname}` 和 `{at}`，可直接按回车换行 |
| **各群专属欢迎消息** | （可选）为不同群定制不同的欢迎词。每行格式：`群号:消息`，例如：<br>`12345678:欢迎 {at} 来到A群！`<br>`87654321:欢迎 {at} 来到B群！`<br>消息内也可使用 `{nickname}` 和 `{at}`，需要换行时用 `\n` 表示（在文本框中直接按回车也会产生换行，保存时会自动转换） |
| **分段符号（可选）** | 若填写此符号（如 `---` 或 `[split]`），插件会将欢迎消息按此符号拆分成多条独立消息发送，符号本身不会出现。留空则不分段 |

- 点击“保存”，配置立即生效，无需重启

### 2. 手动编辑配置文件
配置文件位于 `/AstrBot/data/plugin_data/astrbot_plugin_auto_welcome/config.json`，格式如下：
```json
{
  "target_groups": [12345678, 87654321],
  "welcome_message": "欢迎 {at} 加入本群！（默认）\n请阅读群规。",
  "welcome_messages": "12345678:欢迎 {at} 来到A群！\n87654321:欢迎 {at} 来到B群！",
  "segment_separator": "---"
}
```

##📌 注意事项

- 平台限制：本插件仅支持 OneBot 协议（aiocqhttp），请确保您使用的是该协议适配器。
- 机器人必须已经加入白名单群，且有发送消息的权限。
- 群号在配置界面输入时请直接填写数字，不要加引号。
- 专属消息配置中，群号和消息之间必须使用英文冒号 : 分隔，每行一条。
- 消息内如需换行，请使用 \n（在 WebUI 文本框内直接按回车也会产生换行，但保存时会转为 \n，请放心使用）。
- 分段符号应选择不会在消息正文中出现的字符组合，避免意外拆分。
- 如果新成员入群后未触发欢迎，请检查 AstrBot 日志中是否有相关记录（例如“当前未配置任何生效群组”警告）。
